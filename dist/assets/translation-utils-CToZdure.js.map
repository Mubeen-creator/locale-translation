{"version":3,"file":"translation-utils-CToZdure.js","sources":["../../src/utils/translationUtils.js"],"sourcesContent":["// Translation utilities for dynamic content translation\r\n// NOTE: This file is now deprecated as translations are bundled with sections\r\n// Keeping minimal utilities for legacy compatibility\r\nimport { ref, onMounted } from 'vue'\r\nimport { useI18n } from 'vue-i18n'\r\n\r\n// Cache for translations to avoid repeated requests\r\nconst translationCache = new Map()\r\n\r\n// Logger utility\r\nconst logger = {\r\n  debug: (message, ...args) => {\r\n    if (import.meta.env.DEV) {\r\n      console.log(`[TranslationUtils] ${message}`, ...args)\r\n    }\r\n  },\r\n  warn: (message, ...args) => {\r\n    console.warn(`[TranslationUtils] ${message}`, ...args)\r\n  },\r\n  error: (message, ...args) => {\r\n    console.error(`[TranslationUtils] ${message}`, ...args)\r\n  }\r\n}\r\n\r\n/**\r\n * Get nested translation from object using dot notation\r\n * @param {Object} obj - Translation object\r\n * @param {string} key - Dot notation key (e.g., 'auth.login.title')\r\n * @returns {string|null} Translation value or null\r\n */\r\nfunction getNestedTranslation(obj, key) {\r\n  if (!obj || !key) return null\r\n  \r\n  const keys = key.split('.')\r\n  let result = obj\r\n  \r\n  for (const k of keys) {\r\n    if (result && typeof result === 'object' && k in result) {\r\n      result = result[k]\r\n    } else {\r\n      return null\r\n    }\r\n  }\r\n  \r\n  return typeof result === 'string' ? result : null\r\n}\r\n\r\n/**\r\n * Fetch dynamic translation for a key using lazy loader\r\n * @param {string} key - Translation key\r\n * @param {string} locale - Locale (en, vi)\r\n * @returns {Promise<string>} Translation or key as fallback\r\n */\r\nexport async function fetchDynamicTranslation(key, locale = 'en') {\r\n  const cacheKey = `${locale}:${key}`\r\n  \r\n  // Check cache first\r\n  if (translationCache.has(cacheKey)) {\r\n    logger.debug(`fetchDynamicTranslation: Using cached translation for key '${key}'`)\r\n    return translationCache.get(cacheKey)\r\n  }\r\n  \r\n  logger.debug(`fetchDynamicTranslation: Fetching translation for key '${key}' in locale '${locale}'`)\r\n  \r\n  try {\r\n    // NOTE: Using Vue i18n instead of enterprise i18n system\r\n    // This is a fallback utility - sections now bundle their own translations\r\n    const { t } = useI18n()\r\n    const translation = t(key, key)\r\n    \r\n    if (translation && translation !== key) {\r\n      // Cache the result\r\n      translationCache.set(cacheKey, translation)\r\n      logger.debug(`fetchDynamicTranslation: Found translation '${translation}' for key '${key}'`)\r\n      return translation\r\n    }\r\n\r\n    // Fallback to key itself\r\n    logger.debug(`fetchDynamicTranslation: No translation found, returning key '${key}'`)\r\n    return key\r\n  } catch (error) {\r\n    logger.error(`fetchDynamicTranslation: Error fetching translation for key '${key}':`, error)\r\n    return key\r\n  }\r\n}\r\n\r\n/**\r\n * Translate elements with data-translate attribute\r\n * @param {string} locale - Locale to translate to\r\n */\r\nexport async function triggerTranslationForElements(locale = 'en') {\r\n  const elements = document.querySelectorAll('[data-translate]')\r\n  \r\n  if (elements.length === 0) {\r\n    logger.debug('triggerTranslationForElements: No elements with data-translate found')\r\n    return\r\n  }\r\n  \r\n  logger.debug(`triggerTranslationForElements: Found ${elements.length} elements to translate`)\r\n  \r\n  const translationPromises = Array.from(elements).map(async (element) => {\r\n    const key = element.getAttribute('data-translate')\r\n    if (!key) return\r\n    \r\n    try {\r\n      const translation = await fetchDynamicTranslation(key, locale)\r\n      if (translation && translation !== key) {\r\n        element.textContent = translation\r\n        logger.debug(`triggerTranslationForElements: Translated '${key}' to '${translation}'`)\r\n      }\r\n    } catch (error) {\r\n      logger.error(`triggerTranslationForElements: Failed to translate '${key}':`, error)\r\n    }\r\n  })\r\n  \r\n  await Promise.all(translationPromises)\r\n  logger.debug('triggerTranslationForElements: Completed translation of all elements')\r\n}\r\n\r\n/**\r\n * Vue composable for dynamic translation\r\n * @param {string} locale - Locale to translate to\r\n * @returns {Object} Translation utilities\r\n */\r\nexport function useDynamicTranslation(locale = 'en') {\r\n  const isLoading = ref(false)\r\n  const error = ref(null)\r\n  \r\n  const translate = async (key) => {\r\n    isLoading.value = true\r\n    error.value = null\r\n    \r\n    try {\r\n      const result = await fetchDynamicTranslation(key, locale)\r\n      return result\r\n    } catch (err) {\r\n      error.value = err\r\n      logger.error(`useDynamicTranslation: Error translating '${key}':`, err)\r\n      return key\r\n    } finally {\r\n      isLoading.value = false\r\n    }\r\n  }\r\n  \r\n  const translateElements = async () => {\r\n    isLoading.value = true\r\n    error.value = null\r\n    \r\n    try {\r\n      await triggerTranslationForElements(locale)\r\n    } catch (err) {\r\n      error.value = err\r\n      logger.error('useDynamicTranslation: Error translating elements:', err)\r\n    } finally {\r\n      isLoading.value = false\r\n    }\r\n  }\r\n  \r\n  return {\r\n    translate,\r\n    translateElements,\r\n    isLoading,\r\n    error\r\n  }\r\n}\r\n\r\n/**\r\n * Auto-translate elements when they are added to DOM\r\n * @param {string} locale - Locale to translate to\r\n */\r\nexport function setupAutoTranslation(locale = 'en') {\r\n  const observer = new MutationObserver(async (mutations) => {\r\n    const newElements = []\r\n    \r\n    mutations.forEach((mutation) => {\r\n      mutation.addedNodes.forEach((node) => {\r\n        if (node.nodeType === Node.ELEMENT_NODE) {\r\n          // Check if the node itself has data-translate\r\n          if (node.hasAttribute && node.hasAttribute('data-translate')) {\r\n            newElements.push(node)\r\n          }\r\n          \r\n          // Check for child elements with data-translate\r\n          const childElements = node.querySelectorAll && node.querySelectorAll('[data-translate]')\r\n          if (childElements) {\r\n            newElements.push(...Array.from(childElements))\r\n          }\r\n        }\r\n      })\r\n    })\r\n    \r\n    if (newElements.length > 0) {\r\n      logger.debug(`setupAutoTranslation: Found ${newElements.length} new elements to translate`)\r\n      \r\n      const translationPromises = newElements.map(async (element) => {\r\n        const key = element.getAttribute('data-translate')\r\n        if (!key) return\r\n        \r\n        try {\r\n          const translation = await fetchDynamicTranslation(key, locale)\r\n          if (translation && translation !== key) {\r\n            element.textContent = translation\r\n            logger.debug(`setupAutoTranslation: Translated '${key}' to '${translation}'`)\r\n          }\r\n        } catch (error) {\r\n          logger.error(`setupAutoTranslation: Failed to translate '${key}':`, error)\r\n        }\r\n      })\r\n      \r\n      await Promise.all(translationPromises)\r\n    }\r\n  })\r\n  \r\n  observer.observe(document.body, {\r\n    childList: true,\r\n    subtree: true\r\n  })\r\n  \r\n  logger.debug('setupAutoTranslation: Auto-translation observer started')\r\n  \r\n  return () => {\r\n    observer.disconnect()\r\n    logger.debug('setupAutoTranslation: Auto-translation observer stopped')\r\n  }\r\n}\r\n\r\n/**\r\n * Clear translation cache\r\n * @param {string} locale - Specific locale to clear, or 'all' to clear all\r\n */\r\nexport function clearTranslationCache(locale = 'all') {\r\n  if (locale === 'all') {\r\n    translationCache.clear()\r\n    logger.debug('clearTranslationCache: Cleared all translation cache')\r\n  } else {\r\n    const keysToDelete = Array.from(translationCache.keys()).filter(key => key.startsWith(`${locale}:`))\r\n    keysToDelete.forEach(key => translationCache.delete(key))\r\n    logger.debug(`clearTranslationCache: Cleared cache for locale '${locale}' (${keysToDelete.length} entries)`)\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize translation scanner (legacy function for compatibility)\r\n * @param {string} locale - Locale to scan for\r\n */\r\nexport function initializeTranslationScanner(locale = 'en') {\r\n  logger.debug(`initializeTranslationScanner: Initializing for locale '${locale}'`)\r\n  // This function is kept for compatibility but functionality moved to setupAutoTranslation\r\n  return setupAutoTranslation(locale)\r\n}\r\n\r\n/**\r\n * Auto translate document (legacy function for compatibility)\r\n * @param {string} locale - Locale to translate to\r\n */\r\nexport async function autoTranslateDocument(locale = 'en') {\r\n  logger.debug(`autoTranslateDocument: Auto-translating document for locale '${locale}'`)\r\n  await triggerTranslationForElements(locale)\r\n}"],"names":["translationCache","logger","message","args","fetchDynamicTranslation","key","locale","cacheKey","t","useI18n","translation","error","triggerTranslationForElements","elements","translationPromises","element"],"mappings":"mDAOA,MAAMA,MAAuB,IAGvBC,EAAS,CACb,MAAO,CAACC,KAAYC,IAAS,CAI7B,EACA,KAAM,CAACD,KAAYC,IAAS,CAC1B,QAAQ,KAAK,sBAAsBD,CAAO,GAAI,GAAGC,CAAI,CACvD,EACA,MAAO,CAACD,KAAYC,IAAS,CAC3B,QAAQ,MAAM,sBAAsBD,CAAO,GAAI,GAAGC,CAAI,CACxD,CACF,EA+BA,eAAsBC,EAAwBC,EAAKC,EAAS,KAAM,CAChE,MAAMC,EAAW,GAAGD,CAAM,IAAID,CAAG,GAGjC,GAAIL,EAAiB,IAAIO,CAAQ,EAC/B,OAAAN,EAAO,MAAM,8DAA8DI,CAAG,GAAG,EAC1EL,EAAiB,IAAIO,CAAQ,EAGtCN,EAAO,MAAM,0DAA0DI,CAAG,gBAAgBC,CAAM,GAAG,EAEnG,GAAI,CAGF,KAAM,CAAE,EAAAE,CAAA,EAAMC,EAAA,EACRC,EAAcF,EAAEH,EAAKA,CAAG,EAE9B,OAAIK,GAAeA,IAAgBL,GAEjCL,EAAiB,IAAIO,EAAUG,CAAW,EAC1CT,EAAO,MAAM,+CAA+CS,CAAW,cAAcL,CAAG,GAAG,EACpFK,IAITT,EAAO,MAAM,iEAAiEI,CAAG,GAAG,EAC7EA,EACT,OAASM,EAAO,CACd,OAAAV,EAAO,MAAM,gEAAgEI,CAAG,KAAMM,CAAK,EACpFN,CACT,CACF,CAMA,eAAsBO,EAA8BN,EAAS,KAAM,CACjE,MAAMO,EAAW,SAAS,iBAAiB,kBAAkB,EAE7D,GAAIA,EAAS,SAAW,EAAG,CACzBZ,EAAO,MAAM,sEAAsE,EACnF,MACF,CAEAA,EAAO,MAAM,wCAAwCY,EAAS,MAAM,wBAAwB,EAE5F,MAAMC,EAAsB,MAAM,KAAKD,CAAQ,EAAE,IAAI,MAAOE,GAAY,CACtE,MAAMV,EAAMU,EAAQ,aAAa,gBAAgB,EACjD,GAAKV,EAEL,GAAI,CACF,MAAMK,EAAc,MAAMN,EAAwBC,EAAKC,CAAM,EACzDI,GAAeA,IAAgBL,IACjCU,EAAQ,YAAcL,EACtBT,EAAO,MAAM,8CAA8CI,CAAG,SAASK,CAAW,GAAG,EAEzF,OAASC,EAAO,CACdV,EAAO,MAAM,uDAAuDI,CAAG,KAAMM,CAAK,CACpF,CACF,CAAC,EAED,MAAM,QAAQ,IAAIG,CAAmB,EACrCb,EAAO,MAAM,sEAAsE,CACrF"}